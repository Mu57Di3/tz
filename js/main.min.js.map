{"version":3,"sources":["node_modules/browserify/node_modules/browser-pack/_prelude.js","src/main.js","src/ctrl/editor.js","src/ctrl/popup.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC/IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"main.min.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\r\n * Created by Mu57Di3 on 01.06.2015.\r\n */\r\n\r\nvar MyApp = Marionette.Application.extend({\r\n    el:'body',\r\n\r\n    initialize:function (){\r\n\r\n    },\r\n\r\n\r\n    events:{\r\n        'click button#bNew':'newImageHandler'\r\n    }\r\n\r\n});\r\n\r\nvar AppLayoutView = Backbone.Marionette.LayoutView.extend({\r\n    template: 'templates/main.twig',\r\n\r\n    regions:{\r\n        main : '#app',\r\n        modal: '#modal'\r\n    },\r\n\r\n    events:{\r\n        'click button#bNew':'newImageHandler'\r\n    },\r\n\r\n    onShow: function() {\r\n\r\n    },\r\n\r\n    newImageHandler:function(){\r\n        console.log('new');\r\n        var Modal = require('./ctrl/popup'),\r\n        editor = require('./ctrl/editor');\r\n        this.getRegion('modal').show(new Modal({\r\n            v:new editor(),\r\n            tpl:{\r\n                title:'Новое изображение',\r\n                button:''\r\n            },\r\n            success:false\r\n        }));\r\n    }\r\n\r\n});\r\n\r\nvar app = new MyApp();\r\napp.addRegions({\r\n    app: \".container\"\r\n});\r\napp.on('start',function(){\r\n    //var vEditor = require('./ctrl/editor');\r\n    this.getRegion('app').show(new AppLayoutView());\r\n});\r\napp.start();\r\n\r\n\r\n\r\n\r\n\r\n","/**\r\n * Контроллер редактор\r\n */\r\nvar editorView = Backbone.Marionette.ItemView.extend({\r\n    template: 'templates/editor.twig',\r\n\r\n    canvasContext:null,\r\n    clickX:[],\r\n    clickY:[],\r\n    clickDrag:[],\r\n    paint:false,\r\n\r\n    initialize:function (){\r\n    },\r\n\r\n    events:{\r\n        'click button#bClear':  'clearHandler',\r\n        'click button#bSave':   'saveHandler',\r\n        'mousedown #dSpace':    'canvasMouseDownHandler',\r\n        'mousemove #dSpace':    'canvasMouseMoveHandler',\r\n        'mouseup #dSpace':      'offPaintHandler',\r\n        'mouseleave #dSpace':   'offPaintHandler'\r\n    },\r\n\r\n\r\n\r\n    onRender: function() {\r\n        var wrapper = this.$('div#cWrapper');\r\n        var canvas = document.createElement('canvas');\r\n\r\n        canvas.setAttribute('width', 600);\r\n        canvas.setAttribute('height', 400);\r\n        canvas.setAttribute('id', 'dSpace');\r\n        wrapper.append(canvas);\r\n        if(typeof G_vmlCanvasManager != 'undefined') {\r\n            canvas = G_vmlCanvasManager.initElement(canvas);\r\n        }\r\n        this.canvasContext = canvas.getContext('2d');\r\n    },\r\n\r\n    /**\r\n     * Обработчик события очистки канвы\r\n     */\r\n    clearHandler: function(){\r\n        this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\r\n        this.clickX = [];\r\n        this.clickY = [];\r\n        this.clickDrag = [];\r\n    },\r\n\r\n    /**\r\n     * Сохранение изображения\r\n     */\r\n    saveHandler:function (){\r\n        var imageData = this.canvasContext.canvas.toDataURL('image/jpeg');\r\n        var sendData = {\r\n            'newimage':imageData\r\n        };\r\n        $.ajax({\r\n            url:'http://tz.mu57di3.org/imagehole',\r\n            dataType:'json',\r\n            type:'POST',\r\n            data:sendData\r\n        }).success(function(data){\r\n            console.log('ok');\r\n        }).error(function(data){\r\n            console.log(data);\r\n        });\r\n\r\n    },\r\n\r\n    /**\r\n     * Нажатие кнопки на канве\r\n     */\r\n    canvasMouseDownHandler: function(e){\r\n        this.paint = true;\r\n        var p = this.canvasContext.canvas.getBoundingClientRect();\r\n        this.addClick(e.clientX-p.left, e.clientY-p.top,false);\r\n        this.redraw();\r\n    },\r\n\r\n    /**\r\n     * Движение мышки\r\n     * @param e\r\n     */\r\n    canvasMouseMoveHandler:function(e){\r\n        if (this.paint){\r\n            var p = this.canvasContext.canvas.getBoundingClientRect();\r\n            this.addClick(e.clientX-p.left, e.clientY-p.top,true);\r\n            this.redraw();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Остановка рисование при откускании кнопки мыши или покидании области отрисовки\r\n     * @param e\r\n     */\r\n    offPaintHandler: function(e){\r\n        this.paint = false;\r\n    },\r\n\r\n    addClick: function (x,y,dragging){\r\n        this.clickX.push(x);\r\n        this.clickY.push(y);\r\n        this.clickDrag.push(dragging);\r\n    },\r\n\r\n    redraw:function(){\r\n        this.canvasContext.clearRect(0, 0, this.canvasContext.canvas.width, this.canvasContext.canvas.height);\r\n        this.canvasContext.strokeStyle = \"#000000\";\r\n        this.canvasContext.lineJoin = \"round\";\r\n        this.canvasContext.lineWidth = 5;\r\n\r\n        for(var i=0; i < this.clickX.length; i++) {\r\n            this.canvasContext.beginPath();\r\n            if(this.clickDrag[i] && i){\r\n                this.canvasContext.moveTo(this.clickX[i-1], this.clickY[i-1]);\r\n            }else{\r\n                this.canvasContext.moveTo(this.clickX[i]-1, this.clickY[i]);\r\n            }\r\n            this.canvasContext.lineTo(this.clickX[i], this.clickY[i]);\r\n            this.canvasContext.closePath();\r\n            this.canvasContext.stroke();\r\n        }\r\n    }/*,\r\n\r\n    getPosition: function (e){\r\n        var canvas = this.canvasContext.canvas;\r\n\r\n        var curleft = 0, curtop = 0;\r\n        if (canvas.offsetParent) {\r\n            do {\r\n                curleft += parseInt(canvas.offsetLeft);\r\n                curtop += parseInt(canvas.offsetTop);\r\n            } while (canvas = canvas.offsetParent);\r\n            return { x: e.pageX-curleft, y: e.pageY-curtop };\r\n        }\r\n        return undefined;\r\n\r\n    }*/\r\n\r\n});\r\n\r\nmodule.exports =  editorView;","/**\r\n * Контроллер попапа\r\n */\r\n\r\nvar Modal = Backbone.Marionette.LayoutView.extend({\r\n    template: \"templates/popup.twig\",\r\n\r\n    templateHelpers:{},\r\n\r\n    events:{\r\n        \"click #bSuccess\": 'do_some'\r\n    },\r\n\r\n    regions:{\r\n        content : '#ppContent'\r\n    },\r\n\r\n    initialize: function(options){\r\n        console.log('modal init');\r\n        if (options){\r\n            if (options.success) {\r\n                this.success_handler = options.success;\r\n            }\r\n\r\n            if (options.v){\r\n                this.v = options.v;\r\n            }\r\n\r\n            if (options.tpl){\r\n                this.templateHelpers = options.tpl;\r\n            }\r\n        }\r\n    },\r\n\r\n    onShow:function (){\r\n        console.log('modal show');\r\n        var that = this;\r\n        //$('#myModal .modal-dialog').removeClass('big_form');\r\n        if (this.v) {\r\n            this.getRegion('content').show(this.v);\r\n        }\r\n        $('#myModal').modal('show');\r\n        $('#myModal').on('hide.bs.modal', function (e) {\r\n            that.remove();\r\n        })\r\n    },\r\n\r\n    do_some: function (){\r\n        if (this.success_handler){\r\n            this.success_handler.call(this.v);\r\n        }\r\n    }\r\n});\r\n\r\nmodule.exports = Modal;"]}