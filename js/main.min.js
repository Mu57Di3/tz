!function t(e,n,a){function i(o,c){if(!n[o]){if(!e[o]){var l="function"==typeof require&&require;if(!c&&l)return l(o,!0);if(s)return s(o,!0);var r=new Error("Cannot find module '"+o+"'");throw r.code="MODULE_NOT_FOUND",r}var h=n[o]={exports:{}};e[o][0].call(h.exports,function(t){var n=e[o][1][t];return i(n?n:t)},h,h.exports,t,e,n,a)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<a.length;o++)i(a[o]);return i}({1:[function(t,e,n){var a=Marionette.Application.extend({el:"body",ImagesCollection:null,initialize:function(){},events:{"click button#bNew":"newImageHandler"}}),i=Backbone.Marionette.LayoutView.extend({template:"templates/main.twig",regions:{main:"#app",modal:"#modal"},events:{"click button#bNew":"newImageHandler"},onShow:function(){var e=t("./ctrl/imagelist");app.ImagesCollection=t("./model/images"),app.ImagesCollection.fetch(),this.getRegion("main").show(new e({collection:app.ImagesCollection}))},newImageHandler:function(){var e=t("./ctrl/popup"),n=t("./ctrl/editor");this.getRegion("modal").show(new e({v:new n,tpl:{title:"Новое изображение",button:""},success:!1}))}});window.app=new a,app.addRegions({app:".container"}),app.on("start",function(){this.getRegion("app").show(new i)}),app.start()},{"./ctrl/editor":2,"./ctrl/imagelist":3,"./ctrl/popup":4,"./model/images":5}],2:[function(t,e,n){var a=Backbone.Marionette.ItemView.extend({template:"templates/editor.twig",canvasContext:null,clickX:[],clickY:[],clickDrag:[],paint:!1,initialize:function(){},events:{"click button#bClear":"clearHandler","click button#bSave":"saveHandler","mousedown #dSpace":"canvasMouseDownHandler","mousemove #dSpace":"canvasMouseMoveHandler","mouseup #dSpace":"offPaintHandler","mouseleave #dSpace":"offPaintHandler"},onRender:function(){var t=this.$("div#cWrapper"),e=document.createElement("canvas");e.setAttribute("width",600),e.setAttribute("height",400),e.setAttribute("id","dSpace"),t.append(e),"undefined"!=typeof G_vmlCanvasManager&&(e=G_vmlCanvasManager.initElement(e)),this.canvasContext=e.getContext("2d"),this.clickX=[],this.clickY=[],this.clickDrag=[],this.canvasContext.fillStyle="#ffffff",this.canvasContext.fillRect(0,0,this.canvasContext.canvas.width,this.canvasContext.canvas.height)},clearHandler:function(){this.canvasContext.clearRect(0,0,this.canvasContext.canvas.width,this.canvasContext.canvas.height),this.clickX=[],this.clickY=[],this.clickDrag=[],this.canvasContext.fillStyle="#ffffff",this.canvasContext.fillRect(0,0,this.canvasContext.canvas.width,this.canvasContext.canvas.height)},saveHandler:function(){var t=this.canvasContext.canvas.toDataURL("image/jpeg",1),e={newimage:t};$.ajax({url:"http://tz.mu57di3.org/imagehole",dataType:"json",type:"POST",data:e}).success(function(t){"ok"==t.status&&t.data.length>0&&window.app.ImagesCollection.addImage({name:t.data.name,ts:t.data.ts})}).error(function(t){})},canvasMouseDownHandler:function(t){this.paint=!0;var e=this.canvasContext.canvas.getBoundingClientRect();this.addClick(t.clientX-e.left,t.clientY-e.top,!1),this.redraw()},canvasMouseMoveHandler:function(t){if(this.paint){var e=this.canvasContext.canvas.getBoundingClientRect();this.addClick(t.clientX-e.left,t.clientY-e.top,!0),this.redraw()}},offPaintHandler:function(t){this.paint=!1},addClick:function(t,e,n){this.clickX.push(t),this.clickY.push(e),this.clickDrag.push(n)},redraw:function(){this.canvasContext.clearRect(0,0,this.canvasContext.canvas.width,this.canvasContext.canvas.height),this.canvasContext.strokeStyle="#000000",this.canvasContext.lineJoin="round",this.canvasContext.lineWidth=5,this.canvasContext.fillStyle="#ffffff",this.canvasContext.fillRect(0,0,this.canvasContext.canvas.width,this.canvasContext.canvas.height);for(var t=0;t<this.clickX.length;t++)this.canvasContext.beginPath(),this.clickDrag[t]&&t?this.canvasContext.moveTo(this.clickX[t-1],this.clickY[t-1]):this.canvasContext.moveTo(this.clickX[t]-1,this.clickY[t]),this.canvasContext.lineTo(this.clickX[t],this.clickY[t]),this.canvasContext.closePath(),this.canvasContext.stroke()}});e.exports=a},{}],3:[function(t,e,n){var a=Marionette.ItemView.extend({tagName:"tr",template:"templates/image.twig",events:{},initialize:function(){},onBeforeRender:function(){this.templateHelpers={},this.templateHelpers=this.model.attributes}}),i=Marionette.CollectionView.extend({tagName:"table",childView:a,className:"table table-striped table-bordered",onShow:function(){}});e.exports=i},{}],4:[function(t,e,n){var a=Backbone.Marionette.LayoutView.extend({template:"templates/popup.twig",templateHelpers:{},events:{"click #bSuccess":"do_some"},regions:{content:"#ppContent"},initialize:function(t){t&&(t.success&&(this.success_handler=t.success),t.v&&(this.v=t.v),t.tpl&&(this.templateHelpers=t.tpl))},onShow:function(){var t=this;this.v&&this.getRegion("content").show(this.v),$("#myModal").modal("show"),$("#myModal").on("hide.bs.modal",function(e){t.remove()})},do_some:function(){this.success_handler&&this.success_handler.call(this.v)}});e.exports=a},{}],5:[function(t,e,n){var a=Backbone.Model.extend({defaults:{name:"",ts:0}}),i=Backbone.Collection.extend({model:a,fetch:function(){var t=this;$.ajax({url:"http://tz.mu57di3.org/getImageList",dataType:"json",type:"GET"}).success(function(e){if("ok"==e.status&&e.data.length>0)for(var n=0,i=e.data.length;i>n;n++)t.add(new a(e.data[n]))}).error(function(t){})},save:function(){},addImage:function(t){this.add(new a(t))}});e.exports=new i},{}]},{},[1]);