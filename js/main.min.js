!function t(e,n,i){function a(s,o){if(!n[s]){if(!e[s]){var r="function"==typeof require&&require;if(!o&&r)return r(s,!0);if(c)return c(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=n[s]={exports:{}};e[s][0].call(h.exports,function(t){var n=e[s][1][t];return a(n?n:t)},h,h.exports,t,e,n,i)}return n[s].exports}for(var c="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(t,e,n){var i=Marionette.Application.extend({el:"body",initialize:function(){},events:{"click button#bNew":"newImageHandler"}}),a=Backbone.Marionette.LayoutView.extend({template:"templates/main.twig",regions:{main:"#app",modal:"#modal"},events:{"click button#bNew":"newImageHandler"},onShow:function(){},newImageHandler:function(){var e=t("./ctrl/popup"),n=t("./ctrl/editor");this.getRegion("modal").show(new e({v:new n,tpl:{title:"Новое изображение",button:""},success:!1}))}}),c=new i;c.addRegions({app:".container"}),c.on("start",function(){this.getRegion("app").show(new a)}),c.start()},{"./ctrl/editor":2,"./ctrl/popup":3}],2:[function(t,e,n){var i=Backbone.Marionette.ItemView.extend({template:"templates/editor.twig",canvasContext:null,clickX:[],clickY:[],clickDrag:[],paint:!1,initialize:function(){},events:{"click button#bClear":"clearHandler","click button#bSave":"saveHandler","mousedown #dSpace":"canvasMouseDownHandler","mousemove #dSpace":"canvasMouseMoveHandler","mouseup #dSpace":"offPaintHandler","mouseleave #dSpace":"offPaintHandler"},onRender:function(){var t=this.$("div#cWrapper"),e=document.createElement("canvas");e.setAttribute("width",600),e.setAttribute("height",400),e.setAttribute("id","dSpace"),t.append(e),"undefined"!=typeof G_vmlCanvasManager&&(e=G_vmlCanvasManager.initElement(e)),this.canvasContext=e.getContext("2d"),this.clickX=[],this.clickY=[],this.clickDrag=[]},clearHandler:function(){this.canvasContext.clearRect(0,0,this.canvasContext.canvas.width,this.canvasContext.canvas.height),this.clickX=[],this.clickY=[],this.clickDrag=[]},saveHandler:function(){var t=this.canvasContext.canvas.toDataURL("image/jpeg"),e={newimage:t};$.ajax({url:"http://tz.mu57di3.org/imagehole",dataType:"json",type:"POST",data:e}).success(function(t){}).error(function(t){})},canvasMouseDownHandler:function(t){this.paint=!0;var e=this.canvasContext.canvas.getBoundingClientRect();this.addClick(t.clientX-e.left,t.clientY-e.top,!1),this.redraw()},canvasMouseMoveHandler:function(t){if(this.paint){var e=this.canvasContext.canvas.getBoundingClientRect();this.addClick(t.clientX-e.left,t.clientY-e.top,!0),this.redraw()}},offPaintHandler:function(t){this.paint=!1},addClick:function(t,e,n){this.clickX.push(t),this.clickY.push(e),this.clickDrag.push(n)},redraw:function(){this.canvasContext.clearRect(0,0,this.canvasContext.canvas.width,this.canvasContext.canvas.height),this.canvasContext.strokeStyle="#000000",this.canvasContext.lineJoin="round",this.canvasContext.lineWidth=5;for(var t=0;t<this.clickX.length;t++)this.canvasContext.beginPath(),this.clickDrag[t]&&t?this.canvasContext.moveTo(this.clickX[t-1],this.clickY[t-1]):this.canvasContext.moveTo(this.clickX[t]-1,this.clickY[t]),this.canvasContext.lineTo(this.clickX[t],this.clickY[t]),this.canvasContext.closePath(),this.canvasContext.stroke()}});e.exports=i},{}],3:[function(t,e,n){var i=Backbone.Marionette.LayoutView.extend({template:"templates/popup.twig",templateHelpers:{},events:{"click #bSuccess":"do_some"},regions:{content:"#ppContent"},initialize:function(t){t&&(t.success&&(this.success_handler=t.success),t.v&&(this.v=t.v),t.tpl&&(this.templateHelpers=t.tpl))},onShow:function(){var t=this;this.v&&this.getRegion("content").show(this.v),$("#myModal").modal("show"),$("#myModal").on("hide.bs.modal",function(e){t.remove()})},do_some:function(){this.success_handler&&this.success_handler.call(this.v)}});e.exports=i},{}]},{},[1]);